@page
@model LoginRRHH

@{
    ViewData["Title"] = "Login";
}

<h2>@ViewData["Title"]</h2>

<!-- Formulario de inicio de sesión -->
<form id="loginForm">
    <div>
        <label for="Email">Email</label>
        <input type="email" id="Email" name="Email" required />
    </div>
    <div>
        <label for="Cedula">Cédula</label>
        <input type="text" id="Cedula" name="Cedula" required />
    </div>
    <div>
        <label for="RememberMe">Remember me?</label>
        <input type="checkbox" id="RememberMe" name="RememberMe" />
    </div>
    <button type="submit">Login</button>
</form>

<!-- Mensaje de error o validación -->
<div id="validation-summary" style="color: red; margin-top: 10px;"></div>

@section Scripts {
    <script>
        document.getElementById('loginForm').addEventListener('submit', function (event) {
            event.preventDefault(); // Evitar el envío del formulario

            // Obtener los valores de los campos
            const email = document.getElementById('Email').value;
            const cedula = document.getElementById('Cedula').value;
            const rememberMe = document.getElementById('RememberMe').checked;

            // Crear el objeto de datos para enviar
            const data = {
                Email: email,
                Cedula: cedula,
                RememberMe: rememberMe
            };

            fetch('/LoginRRHH', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
                .then(response => {
                    if (!response.ok) {
                        // Si el estado de la respuesta no es OK (ej. 400 o 500)
                        return response.json().then(err => {
                            throw new Error(err.errorMessage || 'Error en el servidor');
                        });
                    }
                    return response.json();
                })
                .then(responseData => {
                    if (responseData.success) {
                        // Login exitoso, redirige a la página principal
                        window.location.href = '/';
                    } else {
                        // Mostrar mensaje de error
                        document.getElementById("validation-summary").textContent = responseData.errorMessage;
                    }
                })
                .catch(error => {
                    // Manejo de errores de red o de la solicitud
                    console.error('Error:', error);
                    document.getElementById("validation-summary").textContent = error.message;
                });

    </script>
}
